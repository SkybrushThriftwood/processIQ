---
title: ProcessIQ — Agentic Architecture
---
flowchart TD
    %% Styling
    classDef deterministic fill:#d6f5d6,stroke:#2d8a2d,stroke-width:2px,color:#1a1a1a
    classDef agentic fill:#fff3cd,stroke:#b8860b,stroke-width:2px,color:#1a1a1a
    classDef decision fill:#d0e0f7,stroke:#2456b5,stroke-width:2.5px,color:#1a1a1a
    classDef output fill:#f8d7da,stroke:#c0392b,stroke-width:2.5px,color:#1a1a1a
    classDef phase2 fill:#e8e8e8,stroke:#999,stroke-width:1.5px,stroke-dasharray:5 5,color:#666

    %% ── 1. INPUT & INGESTION ──
    subgraph Ingestion ["1 · User Input & Ingestion"]
        direction TB
        UI["Streamlit UI<br>(chat-first)"]:::deterministic
        FILES["File Upload<br>(CSV · Excel · PDF · Word · Images)"]:::deterministic
        CHAT["Chat Description<br>(text)"]:::deterministic

        UI --> FILES
        UI --> CHAT

        FILES --> PARSE["Parse<br>(Docling · pandas)"]:::deterministic
        PARSE --> EXTRACT
        CHAT --> EXTRACT["LLM: Extract ProcessData<br>(Instructor + extraction.j2)"]:::agentic
        EXTRACT --> REVIEW["User Reviews &amp; Edits<br>Extracted Data Card"]:::deterministic
        REVIEW --> VALID

        VALID(["Validated Pydantic Models<br>(ProcessData · Constraints · BusinessProfile)"]):::deterministic
    end

    %% ── 2. AGENT CORE (LANGGRAPH) ──
    subgraph Agent ["2 · Agent Orchestration — LangGraph"]
        direction TB

        CTX{"check_context<br><br>Confidence ≥ threshold?"}:::decision
        CTX -- "No → request_clarification" --> CLARIFY["request_clarification<br><br>LLM generates questions<br>(clarification.j2)"]:::agentic
        CLARIFY -- "User replies → re-check" --> CTX

        CTX -- "Yes → analyze" --> ANALYZE["analyze<br><br>1. Calculate metrics (deterministic)<br>2. LLM analysis (analyze.j2)<br>   — identifies issues &amp; root causes<br>   — generates recommendations + ROI<br>   — flags core value work<br>   — applies feedback history"]:::agentic

        ANALYZE --> FINALIZE["finalize<br><br>Package AnalysisInsight<br>Set current_phase = complete"]:::deterministic
    end

    %% ── 3. KNOWLEDGE ENRICHMENT (Phase 2) ──
    subgraph Knowledge ["3 · Knowledge Enrichment — Phase 2"]
        direction TB
        RAG["RAG / Knowledge Base<br>(ChromaDB)"]:::phase2
        BENCH["Industry Benchmarks"]:::phase2
    end

    %% ── 4. OUTPUT ──
    subgraph Output ["4 · Output & Transparency"]
        direction TB
        RESULT["Results Display<br><br>Process Summary · Issues · Recommendations<br>Core Value Work · Reasoning Trace<br>Confidence Score"]:::output
        EXPORT["Export<br>CSV · Text · Markdown"]:::output
        RESULT --> EXPORT
    end

    %% ── Cross-subgraph connections ──
    VALID --> CTX
    FINALIZE --> RESULT

    %% Feedback loop (session-scoped)
    EXPORT -. "up/down votes on recommendations" .-> ANALYZE

    %% Phase 2
    CLARIFY -.-> RAG
    CLARIFY -.-> BENCH

    %% ── Subgraph styling ──
    style Ingestion fill:#f9fdf9,stroke:#2d8a2d,stroke-width:2px
    style Agent fill:#fffef5,stroke:#b8860b,stroke-width:2px
    style Knowledge fill:#f5f5f5,stroke:#999,stroke-width:1.5px,stroke-dasharray:5 5
    style Output fill:#fef5f5,stroke:#c0392b,stroke-width:2px
